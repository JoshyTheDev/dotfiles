#!/bin/bash
# Find Firefox profile directory

# Check if a wallpaper was provided
if [ -z "$1" ] || [ ! -f "$1" ]; then
    # If no valid path provided, try to use last wallpaper
    if [ -f ~/.cache/wal/wal ]; then
        WALLPAPER=$(cat ~/.cache/wal/wal)
    else
        # Fallback to a random wallpaper
        WALLPAPER=$(find ~/Pictures/Wallpapers -type f | shuf -n 1)
    fi
else
    WALLPAPER="$1"
fi

# Generate pywal colors
wal -i "$WALLPAPER"

# Link pywal colors to Firefox profile
# Update Zen Browser theme
ZEN_PROFILE=~/.zen/"tvn7h7bv.Default (release)"
if [ -d "$ZEN_PROFILE" ]; then
  mkdir -p "$ZEN_PROFILE/chrome"
  ln -sf ~/.cache/wal/colors-firefox.css "$ZEN_PROFILE/chrome/userChrome.css"
fi

pywalfox update

# Reload Hyprland config to apply new colors
hyprctl reload
